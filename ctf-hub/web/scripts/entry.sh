#!/bin/bash

#########################################################################
#                          Container Entrypoint                         #
#########################################################################

# --------------------------------------------------------------------- #
#                   --== Copying Site Config File ==--                  #
# --------------------------------------------------------------------- #

cp /CTF-HUB/config/site.conf  /etc/apache2/sites-available/site.conf

# --------------------------------------------------------------------- #
#                     --== Copying Source Files ==--                    #
# --------------------------------------------------------------------- #

cp -r /CTF-HUB/src /var/www/html/ctf-hub

# --------------------------------------------------------------------- #
#    --== Adding Execution Permission To Web Conatiner Scripts ==--     #
# --------------------------------------------------------------------- #

chmod +x /CTF-HUB/scripts/configure_flags.sh

# --------------------------------------------------------------------- #
#                  --== Starting Apache Server ==--                     #
# --------------------------------------------------------------------- #

service apache2 start

# --------------------------------------------------------------------- #
#              --== Disabling Default & Enabling Site ==--              #
# --------------------------------------------------------------------- #

a2dissite 000-default.conf && a2ensite site.conf

# --------------------------------------------------------------------- #
#                  --== Reloading Apache Server ==--                    #
# --------------------------------------------------------------------- #

service apache2 reload

# --------------------------------------------------------------------- #
#       --== Executiing Web Conatiner Configuration Script ==--         #
# --------------------------------------------------------------------- #

bash /CTF-HUB/scripts/configure_flags.sh

# --------------------------------------------------------------------- #
#         --== Displaying Site Reachable Message with Url ==--          #
# --------------------------------------------------------------------- #

echo "[âœ“] CTF-HUB tea shop deployed you can access it via http://localhost:5555"

# --------------------------------------------------------------------- #
#                       --== Keep The Container ==--                    #
# --------------------------------------------------------------------- #
tail -f /dev/null